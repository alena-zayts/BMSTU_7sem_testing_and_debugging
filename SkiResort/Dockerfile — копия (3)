FROM "mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim" AS baseWORKDIR /appEXPOSE 80EXPOSE 443FROM mcr.microsoft.com/dotnet/core/sdk:3.1-buster AS buildWORKDIR /srcCOPY ["BL/BL.csproj", "BL/"]COPY ["BL.Tests/BL.Tests.csproj", "BL.Tests/"]RUN dotnet restore "BL/BL.csproj"RUN dotnet restore "BL.Tests/BL.Tests.csproj"COPY . .FROM build AS test  ARG BuildIdLABEL test=${BuildId} RUN dotnet test --no-build -c Release --results-directory /testresults --logger "trx;LogFileName=test_results.trx"  BL.Tests/BL.Tests.csproj FROM build AS publishRUN dotnet publish "BL/BL.csproj" --no-restore -c Release  -o /app/publishFROM base AS finalWORKDIR /appCOPY --from=publish /app/publish .ENTRYPOINT ["dotnet", "BL.dll"]